
ç®€ä¹¦åœ°å€:  https://www.jianshu.com/p/b3665b1c238e

# ç®€ä»‹ 
æ—©å°±ç•¥æœ‰è€³é—»TikTokä¼šæœ‰é”åŒºï¼Œç»“åˆä¸€äº› çŸ¥ä¹ä¸Šçš„æ–‡ç«  å¦‚ : https://zhuanlan.zhihu.com/p/181691137ï¼Œ

æŸå®ä¸Štiktokç”µè¯å¡
è¿˜æœ‰åœ¨æŸå®ä¸Šè´©å–çš„TikTokå›½å¤–ç”µè¯å¡å°±èƒ½åŸºæœ¬ç¡®å®šï¼ŒTikTokå°±æ˜¯é€šè¿‡è·å– MCC(ç§»åŠ¨å›½å®¶ç )å’Œ MNC(ç§»åŠ¨ç½‘ç»œç ) è¿›è¡Œé”åŒºçš„äº†ã€‚
æ•´ä½“æ€è·¯å®šäº†ï¼Œå°±å¼€å§‹ç€æ‰‹å¼€å§‹æèµ·ã€‚

å…ˆè·å–ä¸€ä¸‹æœ¬æœºçš„ mcc,mnc ç çœ‹ä¸€ä¸‹

è·å–çš„ç»“æœ
ç„¶ååº¦å¨˜ä¸€ä¸‹å…¨çƒè¿è¥å•† mccï¼Œmncå¤§å…¨ã€‚ (æˆ‘ç”¨çš„æ˜¯ http://ultra.chinasnow.net/opcode  è¿™ä¸ªç½‘ç«™æŸ¥è¯¢çš„)

å…ˆè·å–çš„æ—¥æœ¬çš„ä¸€ä¸ªè¿è¥å•†ç 
ç„¶åç…§è‘«èŠ¦ç”»ç“¢, hookæ‰ è·å–è¿è¥å•†å„ä¸ªä¿¡æ¯çš„getæ–¹æ³•ã€‚ç„¶åç”¨hookç¥å™¨ theosç¼–å†™ä»£ç å¹¶è¿›è¡Œæ³¨å…¥ã€‚

hookä»£ç æŸ¥çœ‹æºç å³å¯

æœ€åå‘ç°æœç„¶è¿™æ ·å°±å¯ä»¥æ’­æ”¾äº†ğŸ˜‚

çªç ´è¿è¥å•†é”åŒºåå¯è§‚çœ‹tiktok
ç„¶åæˆ‘ä»¬å°±å¯ä»¥é¢„åŸ‹ä¸€äº›è‡ªå·±æƒ³çœ‹çš„åœ°åŒºè¿è¥å•†çš„ä¿¡æ¯ï¼Œæ‰©å±•å‡ºä¸€ä¸ªåˆ‡æ¢åœ°åŒºåˆ—è¡¨åŠŸèƒ½äº†ã€‚
å…·ä½“çš„åŒºåŸŸå¯ä»¥è‡ªå·±ä»»æ„é¢„åŸ‹ä¸Šå»

æˆ‘ä»¬è¿˜å¯ä»¥å°†tiktokè¿›è¡Œé‡ç­¾åååˆ†å‘ç»™åˆ«äººæœªè¶Šç‹±çš„è®¾å¤‡è¿›è¡Œå®‰è£…ã€‚
ä½†è¿™é‡Œæœ‰ä¸ªå‘ï¼Œé‚£å°±æ˜¯å½“ä½ é‡ç­¾å bundleIdå‘ç”Ÿæ”¹å˜åï¼Œtiktokå°†æ— æ³•ç™»é™†ã€‚
æˆ‘æ€€ç–‘ä»–ä»¬æ˜¯åšäº†bundleIdåˆæ³•æ€§æ ¡éªŒã€‚
ç„¶åæˆ‘å°±å¯¹ NSBundle çš„ bundleIdentifier æ–¹æ³•è¿›è¡Œäº†hookã€‚ä½†æ¯æ¬¡è¿”å›å›æ¥çš„æ˜¯ä¸ªç‰ˆæœ¬å·ï¼Œå¹¶ä¸æ˜¯bundleIdã€‚
ä¼°è®¡ä»–ä»¬æœ‰åšäº†ä¸€äº›åç§»å¤„ç†ğŸ˜‚ã€‚ æ¥ç€æ‰¾ã€‚æœ€åå®šä½åˆ°  TTInstallSandBoxHelper ç±»çš„  + (id)bundleIdentifier; æ–¹æ³•ã€‚
ç„¶åå¯¹è¯¥æ–¹æ³•åŒæ ·è¿›è¡Œ hookå¤„ç†ï¼Œå¼ºåˆ¶è¿”å› tiktok åŸæ¥çš„bundleIdã€‚è¿™æ ·é‡ç­¾ååä¿®æ”¹äº†bundleIdåçš„ appä¹Ÿå¯ä»¥æ­£å¸¸ ä½¿ç”¨ç™»é™†ï¼ŒæŸ¥çœ‹ç•™è¨€ï¼Œè¿›è¡Œç•™è¨€ï¼Œå…³æ³¨ï¼Œå‘å¸–ï¼Œä¸‹è½½ç­‰åŠŸèƒ½äº†ã€‚

ç›®å‰è¿™ä¸ªç‰ˆæœ¬æ’ä»¶åˆ‡æ¢åŒºåŸŸåéœ€è¦é‡å¯ä¸€ä¸‹ appï¼Œæ²¡æœ‰åšå®æ—¶ç”Ÿæ•ˆåŠŸèƒ½ï¼Œç­‰æœ‰æ—¶é—´çš„æŠŠè¿™ä¸ªå‘å¡«ä¸€ä¸‹ã€‚




# éè¶Šç‹±æ‰‹æœºæ³¨å…¥åŠ¨æ€åº“é‡ç­¾å®‰è£…
* ç ¸å£³å¸‚åœºä¸‹è½½TikTok app
* å…ˆä»è‡ªå·±xocdeé¡¹ç›®ä¸Šè·‘å‡ºä¸€ä¸ªåˆæ³•çš„ æè¿°æ–‡ä»¶(åœ¨ ipaé‡Œé¢æœ‰ embedded.mobileprovision) å¤‡ç”¨
* å…ˆå¤„ç†ä¸€ä¸‹ æè¿°æ–‡ä»¶ (ç”¨ä¸‹è¿°ä¿©æ¡å‘½ä»¤ è·å–  entitlements.plist)
    * security cms -D -i  xxx/embedded.mobileprovision  >  embedded_full.plist
    * /usr/libexec/PlistBuddy -x -c 'Print:Entitlements'  embedded_full.plist   >    entitlements.plist
* å¼€å§‹å¤„ç†dylib
    * dylib ç›®å½•:  TiktokHookTheos/.theos/obj/debug/TikTok_hook.dylib
    * é€šè¿‡ otool -L TikTok_hook.dylib å‘½ä»¤æŸ¥çœ‹ dylibæ³¨å…¥æ˜¯å¦ä¾èµ–ç€ CydiaSubstrate
    * å¦‚æœä¾èµ–ç€ CydiaSubstrate é€šè¿‡  ä¸‹é¢å‘½ä»¤å°† ä¾èµ–è·¯å¾„ä¿®æ”¹ä¸ºlibsubstrate.dylib ï¼ˆè¶Šç‹±æ³¨å…¥åŠ¨æ€åº“ä¾èµ– CydiaSubstrateåº“ï¼Œä½†éè¶Šç‹±æ‰‹æœºæ²¡æœ‰ã€‚æ‰€ä»¥éœ€è¦ä¿®æ”¹ä¸€ä¸‹ æ³¨å…¥åº“ä¾èµ– ï¼‰
        * libsubstrate.dylib æˆ‘æ”¾åœ¨ libsubstrate_dylibæ–‡ä»¶å¤¹ä¸‹äº†ã€‚è¿™é‡Œæœ‰ä¸ªæ·±å‘ï¼Œå¾ˆå¤šä¸Šå¤æ–‡ç« æ¨èçš„ libsubstrate.dylib å¾ˆè€å¾ˆè€äº†ã€‚iOS9ä»¥ä¸Š ä½¿ç”¨ä»–ä¾èµ–åŠ¨æ€åº“æ³¨å…¥çš„è¯å¿…å´©ã€‚
        * æ›¿æ¢åŠ¨æ€åº“ä¾èµ– install_name_tool -change /Library/Frameworks/CydiaSubstrate.framework/CydiaSubstrate @loader_path/libsubstrate.dylib  TikTok_hook.dylib
    * é€šè¿‡ optool æ³¨å…¥å·¥å…· è¿›è¡ŒäºŒè¿›åˆ¶æ³¨å…¥
        * optool install -c load -p "@executable_path/TikTok_hook.dylib" -t  xxx/xxx.app/xxx
    * å°†TikTok_hook.dylibå’Œlibsubstrate.dylib å¤åˆ¶è¿› xxx.appé‡Œé¢
* å¼€å§‹ç­¾å
    * éœ€è¦å°†  TikTok_hook.dylib å’Œ libsubstrate.dylib é‡ç­¾å
        * codesign -f -s "iPhone Developer: xxx(xxx)"     xxx/xxx.app/TikTok_hook.dylib
        * codesign -f -s "iPhone Developer: xxx(xxx)"     xxx/xxx.app/libsubstrate.dylib
    * codesign -f -s "iPhone Developer: xxx(xxx)" --entitlements entitlements.plist  xxx/xxx.app
        * ç­¾åæ—¶å€™åˆ«å«Œéº»çƒ¦ï¼Œæ‰€æœ‰frameworkéƒ½è¦è¿›è¡Œä¸€éé‡ç­¾åã€‚
        * è·¨è¿›ç¨‹æ‰©å±•éƒ½è¦åˆ é™¤æ‰ (åœ¨plugins æ–‡ä»¶ä¸‹)
* æ‰“åŒ…ipa
    * zip -ry xxx.ipa Playload/




